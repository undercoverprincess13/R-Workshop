---
title: "Live Coding"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

# EinfÃ¼hrung

In dieser Session lernen wir die Grundlagen von `ggplot2` einer Kernelemente von tidyverse() library , dem modernen Grafiksystem in R. Es basiert auf dem sogenannten "Grammar of Graphics"-Ansatz, bei dem man einen Plot als Kombination aus **Daten**, **Ã„sthetiken** und **Geometrien** versteht.
# Der Aufbau eines Plots in `ggplot2`
- `aes()` = aesthetics: Definiert, welche Variablen wie dargestellt werden sollen.
- `geom_` = Geometrie des Plots (z.B. Punkte, Balken, Linien).
- Plots kÃ¶nnen **gelayert** werden, d.h. mehrere Geome Ã¼bereinandergelegt.

---



## Schritt 1: Datensatz wÃ¤hlen und ggplot starten
- man hat im Gegensatz zu anderen Visualisierungen hier erstmal nur die ggplot Funktion egal welche Vosualisierung Lininendiagramm etc. wir machen
- es wird geschaut welche Variablen hat man auf der x achse und y achse, welche farben wollen wir etc erst dann geben wir an welches Art von Diagramm wir nehmen wollen 

Wir arbeiten mit dem `mpg`-Datensatz, der in `ggplot2` enthalten ist.

```{r}
glimpse(mpg)
```

## Schritt 2: Einfache Histogramm-Darstellung

Ein Histogramm der Stadtverbrauchswerte (`cty`).
- Wir wollen die cty Spalte also die Galonen pro Meile auf der x Achse haben, wenn wir das ausfÃ¼hren kommt erstmal nicht viel weil ggplot nicht weiÃŸ welches Diagramm wir haben wollen 

```{r}
ggplot(mpg, aes(x = cty))
  
```

Wir mÃ¼ssen angeben welche Art von Diagramm wir haben wollen, dafÃ¼r nutzen wir `geom_` und wÃ¤hlen das Histogramm aus. 
```{r}
ggplot(mpg, aes(x = cty)) +
  geom_histogram()
  
```
- Wir kÃ¶nnen jetzt Labels hinzufÃ¼gen und  Farben 
- grammar of graphics ist geschichtet (llayerd) wir wollen erst den plot grob anzeigen, dann kÃ¶nnen wir extra informationen hinzugÃ¼gen mit `labs()` 


```{r}
ggplot(mpg, aes(x = cty)) +
  geom_histogram() +
  labs(x = "City mileage")
```

## Schritt 3: Frequenzpolygon statt Histogramm
Warum macht man das jetzt so geschichtet? 
- wenn wir statt einem Histogramm ein frequency Polygon 
- das Ergebnis zeigt das Diagramm vom Aufbau Ã¤hnlich ist der einzige unterschied ist der Diagramm Type aber unsere `labs()` x Achsen Beschriftung bleibt und auch der X-Wert -> Diagramm Typ ist sekundÃ¤r 

```{r}
ggplot(mpg, aes(x = cty)) +
  geom_freqpoly() +
  labs(x = "City mileage")
```

## Schritt 4: Mehrere Geometrien kombinieren
- Wir kÃ¶nnen die beiden sogar Ã¼bereinander legen, das ist vielleicht hier nicht so ganz sinnvoll zeigt aber wie stark ggplot bei der Visualisierunng ist und wie leicht die Syntax durch das layern ist 
```{r}
ggplot(mpg, aes(x = cty)) +
  geom_histogram() +
  geom_freqpoly() +
  labs(x = "City mileage")
```

# Scatterplot mit Regressionslinie
Lasst uns ein paar weitere Plots mit dem mpg Datensatz machen beispielsweise ein Scatterplot 
Diesmal nehmen wir `cty` (`milage`) auf die X Achse und `hwy` (`highway milage`) auf die Y Achse 

```{r}
ggplot(mpg, aes(x = cty, y = hwy)) +
  geom_point()
```

Wenn wir das sehen denkt man direkt an eine lineare Regression 
die Regressionslinie kÃ¶nnen wir einfach mit `geom_smooth(method = lm)`
```{r}
ggplot(mpg, aes(x = cty, y = hwy)) +
  geom_point() +
  geom_smooth(method = "lm")
```

# Scatterplot nach Fahrzeugklasse einfÃ¤rben
- wir haben mit Lais ja schon die Fahrzeugklassen gruppiert (`mpg` Dataset zeigen und `class` Spalte zeigen)
- wir kÃ¶nnen jetzt die verschiedenen classen mit Farben kodieren das kÃ¶nnen wir wie die Infos Ã¼ber X und Y Achse unter `aes`thetic machen weil dort alle Infos Ã¼ber die visualisierung angegeben werden. Weil das nichts mit den Achsen zu tun hat fÃ¼gen wir eine extra aesthetic hinzu `color` und wir wollen die `class` einfÃ¤rben 

```{r}
ggplot(mpg, aes(x = cty, y = hwy, color = class)) +
  geom_point()
```

## Farben verbessern (z.B. farbenblindfreundlich)
- Man kannt die Farben manuell bestimmen oder Ã¼ber Farbpalleten einer Funktion `scale_color_brewer`

```{r}
ggplot(mpg, aes(x = cty, y = hwy, color = class)) +
  geom_point() +
  scale_color_brewer(palette = "Dark2")
```

# Gerichteter Zweistichproben-t-Test

**Fragestellung:**  
*Verbrauchen SUVs mehr Sprit in der Stadt als Kompaktwagen?*
- Wir vergleichen den Stadtverbrauch (`cty`, miles per gallon) zwischen Fahrzeugklassen (`class`). Je hÃ¶her der Wert, desto sparsam das Fahrzeug.
### Variablen:
- `cty` = Stadtverbrauch (je mehr Meilen pro Gallone, desto sparsamer).
- `class` = Fahrzeugklasse (`"compact"`, `"suv"`)
### Hypothesen:
- Hâ‚€ (Nullhypothese): Kompaktwagen sind nicht sparsamer als SUVs â†’ `compact â‰¤ suv`
- Hâ‚ (Alternativhypothese): Kompaktwagen sind sparsamer â†’ `compact > suv`

```{r}
# Gerichteter t-Test
t.test(
  cty ~ class,
  data = mpg %>% filter(class %in% c("suv", "compact")),
  alternative = "greater"
)
```

### ErklÃ¤rung Code:

- `t.test()` vergleicht Durchschnittswerte zwischen zwei Gruppen.
- `cty ~ class` bedeutet: "Vergleiche Stadtverbrauch (cty) nach Fahrzeugklasse (class)"
- `data` = ... Ã¼bergibt das gefilterte mpg-Dataframe (nur "suv" und "compact").
- `alternative` = "greater" prÃ¼ft: Ist cty (Wie weit kommt man mit einer Galleone) bei Compact grÃ¶ÃŸer als bei SUV ? -> Dann wÃ¤re der Verbrauch von SUVs hÃ¶her!
- R vergleicht alphabetisch: "compact" (links), "suv" (rechts) â†’ prÃ¼ft â€Linke (erste) Gruppe > rechte (zweite) Gruppeâ€œ
  â†’ Das bedeutet: SUVs verbrauchen **mehr**, da sie **weniger** Meilen pro Gallone schaffen.
  
### ErklÃ¤rung Ergebniss
- 1. t-Wert: 11.393
  -   Das ist der Teststatistik-Wert des t-Tests.
  -   Er zeigt, wie stark sich die Mittelwerte der beiden Gruppen (Kompakt vs. SUV) voneinander unterscheiden, relativ zur Streuung der Daten.
  -   Je grÃ¶ÃŸer der Betrag des t-Werts, desto grÃ¶ÃŸer der Unterschied.
  -   Ein Wert von 11.393 ist sehr groÃŸ â†’ Es gibt einen klaren Unterschied zwischen den Gruppen.
- 2. df (Freiheitsgrade): 79.558
  - Freiheitsgrade (degrees of freedom) bestimmen die Form der t-Verteilung.
  - Hier: Der Wert ist nicht ganzzahlig, weil der Welch-t-Test verwendet wurde (erlaubt ungleiche Varianz).
  - R berechnet diesen Wert automatisch und nutzt ihn, um den korrekten p-Wert zu berechnen.
- 3. p-Wert: < 2.2e-16
  - Der p-Wert gibt an: Wie wahrscheinlich wÃ¤re es, diesen Unterschied zu sehen, wenn es in Wirklichkeit keinen gibt?
  - Hier ist der p-Wert extrem klein: kleiner als 0.00000000000000022.
    - â¤ Sehr hoch signifikant!
  - â†’ Du kannst mit extrem hoher Sicherheit sagen, dass ein echter Unterschied zwischen den Gruppen besteht.
  - Interpretation: Der Unterschied ist nicht durch Zufall erklÃ¤rbar.
- 4. 95%-Konfidenzintervall: [5.66, âˆ)
  - Das Konfidenzintervall sagt dir:
  - â€Mit 95% Sicherheit liegt der wahre Mittelwertunterschied mindestens bei 5.66 mpg.â€œ
  - Da das Intervall ausschlieÃŸlich positiv ist (kein 0 enthalten), bestÃ¤tigt es den signifikanten Unterschied.
-  5. Mittelwerte:
  - Gruppe	Mittelwert (cty)
  - Kompaktwagen	20.13 mpg
  - SUVs	13.50 mpg
  - Kompaktwagen fahren im Schnitt 6.63 Meilen weiter pro Gallone.
  - Das ist ein sehr relevanter praktischer Unterschied, nicht nur statistisch signifikant.

ğŸŸ¢ Interpretation: Kompaktwagen verbrauchen mindestens 5.66 mpg weniger Sprit als SUVs.


# Ergebnis dokumentieren mit R Markdown

R Markdown erlaubt dir, **Code und Text zu kombinieren** und **automatisch** HTML-, PDF- oder Word-Berichte zu erstellen.

## Vorteile

- Kein Copy & Paste zwischen RStudio und Word
- Alle Schritte sind reproduzierbar
- Perfekt fÃ¼r Kommunikation mit Team oder Kunden

# Fazit

`ggplot2` bietet ein **mÃ¤chtiges, flexibles und logisches** Framework zur Erstellung von Grafiken. Du beginnst mit den Daten und beschreibst dann:

1. Welche Variablen du zeigen willst (`aes`)
2. Wie du sie zeigen willst (`geom`)
3. Wie du sie verbessern willst (Labels, Farben, Titel usw.)
